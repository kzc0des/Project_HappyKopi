<form #productForm="ngForm" class="flex flex-col gap-4 h-full">
    <div class=" 
    bg-white shadow-sm 
    flex flex-col items-center justify-center
    px-5 py-8 gap-5 
    w-full flex-1">

        <label for="drink-image-upload" class="relative flex items-center justify-center max-w-xs 
                      rounded-2xl bg-[#fafafa] border-2 border-dashed border-gray-300
                      cursor-pointer transition-colors hover:bg-gray-100"
            [ngClass]="imagePreview ? 'p-2 border-0' : 'px-12 py-20'">

            @if (!imagePreview) {
            <div id="svg-placeholder" class="
                flex flex-col items-center justify-center bg-hapikopi-yellow p-3 rounded-2xl">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-7" viewBox="0 0 24 24">
                    <path fill="#fff"
                        d="M11.5 8C14 8 16 10 16 12.5S14 17 11.5 17S7 15 7 12.5S9 8 11.5 8m0 1A3.5 3.5 0 0 0 8 12.5a3.5 3.5 0 0 0 3.5 3.5a3.5 3.5 0 0 0 3.5-3.5A3.5 3.5 0 0 0 11.5 9M5 5h2l2-2h5l2 2h2a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3V8a3 3 0 0 1 3-3m4.41-1l-2 2H5a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h13a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-2.41l-2-2z" />
                </svg>
            </div>
            } @else {
            <img id="image-preview" [src]="imagePreview" alt="Drink Preview"
                class="w-full h-full object-cover rounded-2xl" />
            }

        </label>
        <input id="drink-image-upload" type="file" class="hidden" accept="image/*" (change)="onFileSelected($event)" />

        <app-itemcard class="w-full" [isEditing]="true" itemTitle="Drink Name" [(ngModel)]="productPayload.name"
            name="productName" #productName="ngModel" required></app-itemcard>

        @if (productName.invalid && (productName.dirty || productName.touched || productForm.submitted)) {
        <div class="text-sm text-red-600 px-4 -mt-3">
            @if (productName.errors?.['required']) {
            <span>Please provide a product name.</span>
            }
        </div>
        }

        <app-itemcard class="w-full" [isEditing]="true" itemTitle="Description" [(ngModel)]="productPayload.description"
            name="productDescription"> </app-itemcard>

        <app-itemcard class="w-full" [isEditing]="true" itemTitle="Base Price" type="number" [(ngModel)]="basePrice"
            name="basePrice" #basePrice="ngModel"> </app-itemcard>

        <app-dropdown-button class="w-full" itemTitle="Category" [(ngModel)]="productPayload.categoryId"
            name="productCategory" #productCategory="ngModel" [options]="categoryOptions" required>
        </app-dropdown-button>

    </div>

    <div class="bg-white flex-1 flex flex-col justify-center items-center px-5 py-8 gap-4">
        <div class="flex flex-col gap-4 w-full">

            <h3 class="text-lg font-bold text-hapikopi-dark w-full">Variants (Sizes)</h3>

            <div class="flex gap-3 flex-nowrap overflow-x-auto pb-5">
                @for(item of availableSizes; track $index){
                <app-modifier-size-card class="flex-shrink-0" [itemName]="item.name" [itemValue]="item.ozAmount || 0"
                    [isSelected]="selectedSizeId === item.id" (notifyClick)="onSizeSelect(item)">
                </app-modifier-size-card>
                }
            </div>
        </div>

        <div class="flex flex-col gap-5 w-full">
            <h3 class="text-lg font-semibold text-hapikopi-dark w-full mt-4">Ingredients for {{ currentVariant?.size }}
            </h3>

            <app-add-button-card itemName="Add an Ingredient" [isDisabled]="selectedSizeId === null"
                (notifyClick)="openIngredientModal()"></app-add-button-card>

            @if(currentVariant) {
            @for(ingredient of currentVariant.recipe; track ingredient; let i = $index) {
            <app-selected-ingredient-card [ingredient]="ingredient" (edit)="onEditIngredient(ingredient, i)"></app-selected-ingredient-card>
            }
            }

            <h3 class="text-lg font-semibold text-hapikopi-dark w-full mt-4">Add-ons for {{ currentVariant?.size }}</h3>

            <app-add-button-card itemName="Add an Add-on" [isDisabled]="selectedSizeId === null"
                (notifyClick)="openAddOnModal()"></app-add-button-card>

            @if(currentVariant) {
            @for(addOn of currentVariant.addOns; track addOn; let i = $index) {
            <app-selected-addon-card [addon]="addOn" (edit)="onEditAddOn(addOn, i)"></app-selected-addon-card>
            }
            }
        </div>

        <div class="w-full mt-6">
            <app-yellow-button class="w-full py-4" buttonTitle="Save New Drink" itemTitle="submit"
                (isClick)="submitNewProduct(productForm)">
            </app-yellow-button>
        </div>
    </div>
</form>


<app-add-ingredient-modal [isEditing]="editingIngredientIndex !== null" [ingredient]="editingIngredient"
    [categoryOptions]="itemOptions" [ingredientOptions]="ingredientOptions" (saveIngredient)="onSaveIngredient($event)"
    (deleteIngredient)="onDeleteIngredient()">
</app-add-ingredient-modal>

<app-add-addon-modal [isEditing]="editingAddOnIndex !== null" [addon]="editingAddOn" [addOnOption]="addOnOptions"
    (saveAddOn)="onSaveAddOn($event)" (deleteAddOn)="onDeleteAddOn()">
</app-add-addon-modal>